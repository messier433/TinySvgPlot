function getMax(e){let t=e.length,l=-1/0;for(;t--;)l=e[t]>l?e[t]:l;return l}function getMin(e){let t=e.length,l=1/0;for(;t--;)l=e[t]<l?e[t]:l;return l}function num2eng(t){var l=["y","z","a","f","p","n","u","m","","k","M","G","T","P","E","Z","Y"],n=Array(t.length);for(idx=0;idx<t.length;++idx){var i=t[idx].toExponential(5).split(/e/);let e=Math.floor(+i[1]/3)+8;e>l.length-1?e=l.length-1:e<0&&(e=0),n[idx]=Math.round(i[0]*Math.pow(10,+i[1]-3*(e-8))*1e3)/1e3+l[e]}return n}function linspace(e,t,l){for(numel=Math.floor((l-e)/t)+1,out=Array(numel),idx=0,val=e;val<=l;++idx,val+=t)out[idx]=val;return out}function logspace(e,t,l){for(numel=Math.floor((l-e)/t)+1,out=Array(numel),idx=0,val=e;val<=l;++idx,val+=t)out[idx]=Math.log10(val);return out}function decades(e,t,l){for(numel=Math.floor((l-e)/t)+1,out=Array(numel),idx=0,val=e;val<=l;++idx,val+=t)out[idx]=Math.pow(10,val);return out}function createSVGElement(e,t){var l,n=document.createElementNS("http://www.w3.org/2000/svg",e);for(l in t)n.setAttribute(l,t[l]);return n}function appendSvgText(e,t,l,n,i,a="middle",o="Sans,Arial",r="black"){l=createSVGElement("text",{x:l,y:n,fill:r,"font-size":i,"text-anchor":a,"font-family":o,"stroke-width":1});return l.append(document.createTextNode(t)),e.appendChild(l),l}function appendSvgLine(e,t,l,n,i,a="black",o=""){t=createSVGElement("line",{x1:t,y1:l,x2:n,y2:i,stroke:a,"stroke-width":1,"stroke-dasharray":o,"vector-effect":"non-scaling-stroke"});return e.appendChild(t),t}function toggleLineVisibility(e,t,l){var n=document.getElementById("pl_"+e+"_"+t).style.display;if(0==l){var i=document.getElementById("gpl_"+e+"_"+t);"none"===n?(document.getElementById("pl_"+e+"_"+t).style.display="block",document.getElementById("lli_"+e+"_"+t).style.opacity=1,document.getElementById("lti_"+e+"_"+t).style.opacity=1,null!=i&&(i.style.display="block")):(document.getElementById("pl_"+e+"_"+t).style.display="none",document.getElementById("lli_"+e+"_"+t).style.opacity=.3,document.getElementById("lti_"+e+"_"+t).style.opacity=.3,null!=i&&(i.style.display="none"))}else for(idx=0;idx<l;++idx){var a=document.getElementById("gpl_"+e+"_"+idx);"none"===n?(document.getElementById("pl_"+e+"_"+idx).style.display="block",document.getElementById("lli_"+e+"_"+idx).style.opacity=1,document.getElementById("lti_"+e+"_"+idx).style.opacity=1,null!=a&&(a.style.display="block")):idx!=t&&(document.getElementById("pl_"+e+"_"+idx).style.display="none",document.getElementById("lli_"+e+"_"+idx).style.opacity=.3,document.getElementById("lti_"+e+"_"+idx).style.opacity=.3,null!=a)&&(a.style.display="none")}}function removeInvalidPoints(e){var t=e[0],l=e[1],n=Array(t.length),i=Array(l.length);if(t.length==l.length){var a=0;for(idx=0;idx<l.length;++idx)isFinite(t[idx])&&isFinite(l[idx])&&(n[a]=t[idx],i[a]=l[idx],++a);a<t.length&&(n=n.slice(0,a),i=i.slice(0,a))}else{var a=0,o=l.length/t.length,r=t.length;for(idx=0;idx<r;++idx){var d=isFinite(t[idx]),s=!0;for(idxLines=0;idxLines<o;++idxLines){if(!isFinite(l[idxLines*r+idx])){s=!1;break}i[idxLines*r+a]=l[idxLines*r+idx]}d&&s&&(n[a]=t[idx],++a)}if(a<t.length){for(n=n.slice(0,a),idx=a=0;idx<l.length;++idx)idx%r<n.length&&(i[a]=i[idx],++a);i=i.slice(0,n.length*o)}}return[n,i]}function resizeSvg(e,t,l,n,i){var a=document.getElementById("svg_leg_"+e),o=document.getElementById("svg_draw_"+e),e=document.getElementById("svg_"+e),r=e.width.baseVal.value-t,d=e.height.baseVal.value-l,s=o.width.baseVal.value,g=o.height.baseVal.value;if(tooltips=document.getElementsByClassName("tooltip"),s!=r)for(o.width.baseVal.value=r,idx=0;idx<tooltips.length;++idx){var c=o.x.baseVal.value,p=tooltips[idx].transform.baseVal[0].matrix.e;tooltips[idx].transform.baseVal[0].matrix.e=c+(p-c)*r/s}if(g!=d)for(o.height.baseVal.value=d,null!=a&&(a.height.baseVal.value=t=n<(t=d-i)?n:t,a.viewBox.baseVal.height=t),idx=0;idx<tooltips.length;++idx){var h=o.y.baseVal.value,x=tooltips[idx].transform.baseVal[0].matrix.f;tooltips[idx].transform.baseVal[0].matrix.f=h+(x-h)*d/g}}function scrollLegend(e,t,l){var n=document.getElementById("svg_leg_"+t),t=document.getElementById("rect_leg_"+t),e=(n.viewBox.baseVal.y+=e.deltaY,l-n.height.baseVal.value);return n.viewBox.baseVal.y<0&&(n.viewBox.baseVal.y=0),n.viewBox.baseVal.y>e&&(n.viewBox.baseVal.y=e),t.y.baseVal.value=n.viewBox.baseVal.y,!1}function plotClicked(e,t,l,n,i,a,o,r,d,s){if(svgDraw=document.getElementById("svg_draw_"+t),svg=document.getElementById("svg_"+t),null!=(closestEl=getNearestLine(e.clientX,e.clientY))){for(var g=e.offsetX-svgDraw.x.baseVal.value,e=e.offsetY-svgDraw.y.baseVal.value,c=l/svgDraw.width.baseVal.value,p=n/svgDraw.height.baseVal.value,h=(g*=c,e*=p,closestEl.points),x=g>h[h.length-1].x?h.length-1:0,m=1;m<h.length;++m){h[m].x,h[m].y;if(h[m].x>=g&&h[m-1].x<=g){x=m-1;break}}var m,u=h.length<=(u=x+1)?h.length-1:u,v=(h[m=g-h[x].x>h[u].x-g?u:x].x-g)*(h[m].x-g)+(h[m].y-e)*(h[m].y-e),v=h[x=v<36?m:x].x-h[u=v<36?m:u].x,f=h[x].y-h[u].y,y=v*v+f*f,v=v/y*(h[x].x-g)+f/y*(h[x].y-e),f=h[u].x*(v=u==x?1:v)+h[x].x*(1-v),y=h[u].y*v+h[x].y*(1-v),e=f/c+svgDraw.x.baseVal.value,u=y/p+svgDraw.y.baseVal.value,v=closestEl.id,c=v.slice(("pl_"+t).length,v.length),p=document.getElementById("lti_"+t+c),v=document.getElementById("pl_"+t+c),v=(lineColor=v.getAttribute("stroke"),sourceCoord=convertCoord([f,y],l,n,[i,a],[o,r],d,s),document.getElementById("gpl_"+t+c)),f=(null==v&&(v=createSVGElement("g",{id:"gpl_"+t+c}),svg.append(v)),createSVGElement("g",{class:"tooltip",transform:"translate("+e+" "+u+")"})),y=(f.onclick=e=>{"g"==e.srcElement.parentNode.tagName&&e.srcElement.parentNode.remove()},createSVGElement("rect",{x:5,y:-9,stroke:"rgb(223,223,223)",fill:lineColor,rx:4,"vector-effect":"non-scaling-stroke"})),l=(f.append(y),null),n=(null!=p&&((text=appendSvgText(f,p.textContent,7,-11,12,"start","Sans,Arial","white")).setAttribute("font-weight","bold"),l=appendSvgLine(f,5,-8,5,-8,stroke="white"),y.setAttribute("y",-23)),appendSvgText(f,"x: "+num2eng([sourceCoord[0]]),7,4,12,"start","Sans,Arial","white"),appendSvgText(f,"y: "+num2eng([sourceCoord[1]]),7,18,12,"start","Sans,Arial","white"),v.append(f),f.getBBox()),i=(y.setAttribute("width",n.width+4),y.setAttribute("height",n.height+4),null!=l&&l.setAttribute("x2",n.width+4+5),createSVGElement("rect",{x:-2,y:-2,width:4,height:4,fill:"black"}));f.append(i)}}function plotMouseDown(e,t){2==e.button&&(svg=document.getElementById("svg_"+t),e=createSVGElement("rect",{id:"zoom_rect"+t,x:e.offsetX,y:e.offsetY,height:0,width:0,fill:"black","fill-opacity":"0.3"}),svg.appendChild(e),svg.onmousemove=e=>plotZoom(e,t))}function plotZoom(e,t){(rectZoom=document.getElementById("zoom_rect"+t)).width.baseVal.value=e.offsetX-rectZoom.x.baseVal.value,rectZoom.height.baseVal.value=e.offsetY-rectZoom.y.baseVal.value,2!=e.buttons&&(rectZoom.remove(),(svg=document.getElementById("svg_"+t)).onmousemove=null)}function convertCoord(e,t,l,n,i,a,o){return x=e[0]/t*(n[1]-n[0])+n[0],y=(1-e[1]/l)*(i[1]-i[0])+i[0],x=a?Math.pow(10,x):x,y=o?Math.pow(10,y):y,[x,y]}function getNearestLine(l,n){var i=null,a=1/0;for(let t=l-4;t<=l+4;t++)for(let e=n-4;e<=n+4;e++){var o,r=document.elementFromPoint(t,e);"polyline"==r?.tagName&&(o=(t-l)*(t-l)+(e-n)*(e-n))<a&&(a=o,i=r)}return i}function plotSvg(t,e,l,n,{title:i="",subtitle:a="",xlabel:o="",ylabel:r="",xlim:d=[],ylim:s=[],legend:g=[],xScale:P="linear",yScale:c="linear",grid:Y=!0,gridMinor:p=[],legendLocation:h="northeastoutside"}={}){var X="http://www.w3.org/2000/svg",x=10,m=10,u=[1,2,5,10],D=["rgb(0,114,190)","rgb(218,83,25)","rgb(238,178,32)","rgb(126,47,142)","rgb(119,173,48)","rgb(77,191,239)","rgb(163,20,47)"],v=(logXEnbl=!1,"log"==P&&(e=e.map(Math.log10),1<d.length&&(d=d.map(Math.log10),isNaN(d[0])||isNaN(d[1])?d=[]:(d[0]=d[0]==-1/0?0:d[0],d[1]=d[1]==-1/0?0:d[1])),logXEnbl=!0),logYEnbl=!1,"log"==c&&(l=l.map(Math.log10),1<s.length&&(s=s.map(Math.log10),isNaN(s[0])||isNaN(s[1])?s=[]:(s[0]=s[0]==-1/0?0:s[0],s[1]=s[1]==-1/0?0:s[1])),logYEnbl=!0),e=(newPts=removeInvalidPoints([e,l]))[0],l=newPts[1],document.getElementById(t)),f=document.createElement("div"),v=(v.appendChild(f),f.setAttribute("style","width:100%;height:calc(100vh - 16px);overflow:none"),createSVGElement("svg",{id:"svg_"+t,width:"100%",height:"100%"}));f.appendChild(v);var f=(f=v.width.baseVal.value)<1200?1200:f,y=(y=v.height.baseVal.value)<800?800:y,b=(v.innerHTML+="<style>\n<![CDATA[\n  polyline.l {\n    stroke-width:2;\n    vector-effect:non-scaling-stroke;\n    fill:none;\n  }\n  text.cll {\n    font-size:10px;\n    fill:black;\n    dominant-baseline:middle;\n    font-family:Lucida Sans Typewriter;\n  }\n]]>\n</style>\n",0),w=48,z=i.split("\n"),O=a.split("\n"),E=(0<i.length&&(b+=28*z.length),0<a.length&&(b+=16*O.length),y-(b+=10)-24),k=f-w,Z=(0<o.length&&(E=E-12-4),0<r.length&&(w=w+12+4,k=k-12-4),createSVGElement("g")),F=0;if(0<g.length&&0<n&&0<e.length){var U="";switch(h){case"northeast":yLegend=b+8,F=16,U="white";break;case"northeastoutside":yLegend=b,U="none";break;default:throw new Error("LegendLocation not supported")}hLegendMax=E-F,v.appendChild(Z);var A=createSVGElement("defs"),_=(v.appendChild(A),createSVGElement("line",{id:"ll_"+t,x1:0,y1:0,x2:20,y2:0,"stroke-width":2,"vector-effect":"non-scaling-stroke"})),I=(A.appendChild(_),wLegendMax=400,hLetter=10,createSVGElement("svg",{id:"svg_leg_"+t})),R=n,j=g,H=(g.length>n&&(j=g.slice(0,R)),R*(hLetter+4)+4),A=H>hLegendMax?hLegendMax:H,_=(I.setAttribute("x","100%"),I.setAttribute("height",A),Z.appendChild(I),createSVGElement("rect",{id:"rect_leg_"+t,x:0,y:0,height:"100%",fill:U,stroke:"black","stroke-width":2,"vector-effect":"non-scaling-stroke"}));for(I.appendChild(_),lineIdx=0;lineIdx<R;++lineIdx){colorIdx=lineIdx%D.length,yOffset=lineIdx*(hLetter+4)+4;var q=new createSVGElement("g",{id:"lgi_"+t+"_"+lineIdx,onclick:'toggleLineVisibility("'+t+'", '+lineIdx+", 0);",ondblclick:'toggleLineVisibility("'+t+'", '+lineIdx+", "+n+");"}),J=(I.appendChild(q),createSVGElement("use",{id:"lli_"+t+"_"+lineIdx,x:4,y:yOffset+hLetter/2,href:"#ll_"+t,stroke:D[colorIdx]})),K=(q.appendChild(J),createSVGElement("text",{id:"lti_"+t+"_"+lineIdx,class:"cll",x:28,y:yOffset+hLetter/2}));lineIdx<j.length?K.append(document.createTextNode(j[lineIdx])):K.append(document.createTextNode("")),q.appendChild(K)}var S=(S=Z.getBBox().width+8)>wLegendMax?wLegendMax:S;for(_.setAttribute("width","100%"),I.setAttribute("width",S),lineIdx=0;lineIdx<R;++lineIdx){colorIdx=lineIdx%D.length,yOffset=lineIdx*(hLetter+4)+4;const q=document.getElementById("lgi_"+t+"_"+lineIdx);var Q=createSVGElement("rect",{id:"lri_"+t+"_"+lineIdx,x:4,y:yOffset,width:S,height:hLetter+4,fill:"none","pointer-events":"visible"});q.appendChild(Q)}var W=0;switch(h){case"northeast":W=-S-8-48,k-=48;break;case"northeastoutside":W=-S,k-=S+4;break;default:throw new Error("LegendLocation not supported")}I.setAttribute("x","calc(100% + "+W+"px)"),I.setAttribute("y",yLegend),I.setAttribute("viewBox","0 0 "+S+" "+A)}else k-=48;var V=[f-(plotArea=[w,b,k,E])[2],y-plotArea[3]],$=createSVGElement("svg",{x:plotArea[0],overflow:"visible",width:"calc(100% - "+V[0]+"px)"}),L=(v.appendChild($),0);if(0<i.length)for(idx=0;idx<z.length;++idx)L=L+24+4,appendSvgText($,z[idx],"50%",L,24);if(0<a.length)for(idx=0;idx<O.length;++idx)L=L+12+4,appendSvgText($,O[idx],"50%",L,12);var _=-y+plotArea[1]+plotArea[3],h=createSVGElement("g",{transform:"translate("+plotArea[0]+" "+_+")"}),ee=createSVGElement("svg",{overflow:"visible",y:"100%",width:"calc(100% - "+V[0]+"px)"}),te=(h.appendChild(ee),v.appendChild(h),0<o.length&&appendSvgText(ee,o,"50%",36,12),createSVGElement("svg",{y:plotArea[1],overflow:"visible",height:"calc(100% - "+V[1]+"px)"})),M=(v.appendChild(te),0<r.length&&((A=createSVGElement("text",{"writing-mode":"sideways-lr",fill:"black","font-size":12,"text-anchor":"middle","font-family":"Sans,Arial","stroke-width":1,y:"50%",x:plotArea[0]-48-4})).append(document.createTextNode(r)),te.appendChild(A)),0),T=0,B=0,C=0,f=(d.length<2?(M=getMin(e),T=getMax(e),NaN==M&&(M=0,T=1),M==T&&(M-=.5,T+=.5)):(M=d[0],T=d[1]),s.length<2?(B=getMin(l),C=getMax(l),NaN==B&&(B=0,C=1),B==C&&(B-=.5,C+=.5)):(B=s[0],C=s[1]),v.width.baseVal.value-V[0]),w=v.height.baseVal.value-V[1],G=createSVGElement("svg",{id:"svg_draw_"+t,preserveAspectRatio:"none",viewBox:"0 0 "+plotArea[2]+" "+plotArea[3],width:f,height:w,x:plotArea[0],y:plotArea[1]}),E=!1,i=!1,i=p.length<1?(E="log"==P,"log"==c):(E=p[0],p[1]),a=(T-M)/10,y=Math.floor(Math.log10(a)),le=Math.ceil(a/Math.pow(10,y)),_=u.findIndex(function(e){return le<=e}),a=u[_]*Math.pow(10,y),h=(logXEnbl?1<=T-M?1<(a=a<1?1:a)&&(x=x<a?x:a):x=0:x=5,(C-B)/10),y=Math.floor(Math.log10(h)),le=Math.ceil(h/Math.pow(10,y)),_=u.findIndex(function(e){return le<=e}),h=u[_]*Math.pow(10,y),o=(logYEnbl?1<=C-B?1<(h=h<1?1:h)&&(m=m<h?m:h):m=0:m=5,d.length<1&&4<=(T-M)/a&&(M=Math.floor(M/a)*a,T=Math.ceil(T/a)*a),s.length<1&&4<=(C-B)/h&&(B=Math.floor(B/h)*h,C=Math.ceil(C/h)*h),Math.ceil(M/a)*a),r=Math.floor(T/a)*a,A=Math.ceil(B/h)*h,f=Math.floor(C/h)*h,w=plotArea[2]*(o-M)/(T-M),P=plotArea[3]*(f-C)/(C-B),ne=100*(o-M)/(T-M),ie=100*(f-C)/(C-B),ae=Math.round((r-o)/a),oe=Math.round((f-A)/h),c=plotArea[2]>plotArea[3]?plotArea[2]/100:plotArea[3]/100,p=c/2;for(xTickLabel=logXEnbl?num2eng(decades(o,a,r)):num2eng(linspace(o,a,r)),yTickLabel=logYEnbl?num2eng(decades(A,h,f)):num2eng(linspace(A,h,f)),dXTick=plotArea[2]*a/(T-M),dXTickPct=100*a/(T-M),dYTick=plotArea[3]*h/(C-B),dYTickPct=100*h/(C-B),idx=0;idx<=oe;++idx){var re=-ie+dYTickPct*idx;(K=appendSvgText(te,yTickLabel[oe-idx],plotArea[0]-6,re+"%",12,"end")).setAttribute("alignment-baseline","middle")}for(idx=0;idx<=ae;++idx){var de=dXTickPct*idx+ne;appendSvgText(ee,xTickLabel[idx],de+"%",12*1.4,12)}var u=document.createElementNS(X,"defs"),se=(G.appendChild(u),i&&0<m&&(_=createSVGElement("g",{id:"mgy_"+t}),Y&&appendSvgLine(_,0,1,plotArea[2],1,stroke="rgb(223,223,223)",strokedasharray="2 4"),appendSvgLine(_,0,1,p,1),appendSvgLine(_,plotArea[2]-p,1,plotArea[2],1),u.appendChild(_)),createSVGElement("pattern",{id:"yTick_"+t,x:0,y:P-1,width:plotArea[2],height:dYTick,patternUnits:"userSpaceOnUse"}));if(u.appendChild(se),i&&0<m)for(logYEnbl&&1==h?(minorTickPos=logspace(1,9/(m-1),10)).forEach((e,t)=>{minorTickPos[t]=(1-minorTickPos[t])*dYTick}):minorTickPos=linspace(0,1/m*dYTick,dYTick),idx=1;idx<minorTickPos.length-1;++idx){var ge=createSVGElement("use",{href:"#mgy_"+t,y:minorTickPos[idx]});se.append(ge)}Y&&appendSvgLine(se,0,1,plotArea[2],1,stroke="rgb(223,223,223)"),appendSvgLine(se,0,1,c,1),appendSvgLine(se,plotArea[2]-c,1,plotArea[2],1);var y=createSVGElement("rect",{x:0,y:0,width:plotArea[2],height:plotArea[3],fill:"url(#yTick_"+t+")"}),d=(G.appendChild(y),document.createElementNS(X,"defs")),ce=(G.appendChild(d),E&&0<x&&(s=createSVGElement("g",{id:"mgx_"+t}),Y&&appendSvgLine(s,1,0,1,plotArea[3],stroke="rgb(223,223,223)",strokedasharray="2 4"),appendSvgLine(s,1,0,1,p),appendSvgLine(s,1,plotArea[3]-p,1,plotArea[3]),d.appendChild(s)),createSVGElement("pattern",{id:"xTick_"+t,x:w-1,y:0,width:dXTick,height:plotArea[3],patternUnits:"userSpaceOnUse"}));if(d.appendChild(ce),E&&0<x)for(logXEnbl&&1==a?(minorTickPos=logspace(1,9/(x-1),10)).forEach((e,t)=>{minorTickPos[t]*=dXTick}):minorTickPos=linspace(0,1/x*dXTick,dXTick),idx=1;idx<minorTickPos.length-1;++idx){var pe=createSVGElement("use",{href:"#mgx_"+t,x:minorTickPos[idx],"vector-effect":"non-scaling-stroke"});ce.append(pe)}Y&&appendSvgLine(ce,1,0,1,plotArea[3],stroke="rgb(223,223,223)"),appendSvgLine(ce,1,0,1,c),appendSvgLine(ce,1,plotArea[3]-c,1,plotArea[3]);var o=createSVGElement("rect",{x:0,y:0,width:plotArea[2],height:plotArea[3],fill:"url(#xTick_"+t+")"}),he=(G.appendChild(o),l.length/n),xe=e.length==l.length;if(!xe&&he!=e.length)throw new Error("Dimension must agree");for(lineIdx=0;lineIdx<n;++lineIdx){var N=e.length,me=new Array(2*N);for(colorIdx=lineIdx%D.length,ptIdx=0;ptIdx<he;++ptIdx){var ue=xe?e[lineIdx*he+ptIdx]:e[ptIdx],ve=l[lineIdx*he+ptIdx];me[2*ptIdx]=plotArea[2]*(ue-M)/(T-M),me[2*ptIdx+1]=plotArea[3]-plotArea[3]*(ve-B)/(C-B)}N=document.createElementNS(X,"polyline");N.setAttribute("class","l"),N.setAttribute("id","pl_"+t+"_"+lineIdx),N.setAttribute("points",me.join(" ")),N.setAttribute("stroke",D[colorIdx]),G.appendChild(N)}r=createSVGElement("rect",{x:0,y:0,width:plotArea[2],height:plotArea[3],fill:"none",stroke:"black","stroke-width":2,"vector-effect":"non-scaling-stroke"});G.appendChild(r),v.appendChild(G),v.appendChild(Z),G.onclick=e=>plotClicked(e,t,plotArea[2],plotArea[3],M,T,B,C,logXEnbl,logYEnbl),v.oncontextmenu=e=>{e.preventDefault()},G.onmousedown=e=>plotMouseDown(e,t),v.onmousedown=e=>{e.preventDefault()},0<g.length&&(Z.onwheel=e=>scrollLegend(e,t,H)),new ResizeObserver(()=>resizeSvg(t,V[0],V[1],H,F)).observe(v)}